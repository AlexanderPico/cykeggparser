package org.cytoscape.keggparser.parsing;

import org.cytoscape.keggparser.com.Graph;
import org.slf4j.LoggerFactory;
import org.w3c.dom.Document;
import org.w3c.dom.Node;

import javax.xml.parsers.DocumentBuilder;
import javax.xml.parsers.DocumentBuilderFactory;
import javax.xml.parsers.SAXParser;
import javax.xml.parsers.SAXParserFactory;
import java.io.File;
import java.io.FileInputStream;
import java.io.InputStream;

public class Parser {
    private static final String EXTERNAL_DTD_LOADING_FEATURE =
    "http://apache.org/xml/features/nonvalidating/load-external-dtd";

    public void createBlankDocument(String kgml){
            System.out.println("Creating Balnk Document...");
            try{
                DocumentBuilderFactory factory = DocumentBuilderFactory.newInstance();
                DocumentBuilder builder = factory.newDocumentBuilder();
                Document document = builder.parse(kgml);
                Node node = document.getDocumentElement();
                String root = node.getNodeName();
                System.out.println("Root Node: " + root);

            }catch(Exception e){
                System.out.println(e.getMessage());
            }

            System.out.println("Done...");
            System.out.println("Exiting...");

    }
    public Graph parse(File kgmlFile){
        Graph graph = new Graph();
        SAXParserFactory factory = SAXParserFactory.newInstance();
        try {

            InputStream xmlInput  = new FileInputStream(kgmlFile);
            factory.setNamespaceAware(true);
            factory.setValidating(false);

            SAXParser      saxParser = factory.newSAXParser();
            saxParser.getXMLReader().setFeature(EXTERNAL_DTD_LOADING_FEATURE, false);

            SaxHandler handler   = new SaxHandler(graph);
            saxParser.parse(xmlInput, handler);
        } catch (Throwable err) {
            err.printStackTrace ();
            return null;
        }
        LoggerFactory.getLogger("CyUserMessages").debug(graph.toString());
        System.out.println(graph.toString());
        return graph;
    }

    public static void main(String[] args) {
        Parser keggParser = new Parser();
        File kgml = new File("D:/KEGG_parser/hsa04621.xml");
        keggParser.parse(kgml);
    }
}
